# Security: Secret Management Quick Reference

This is a quick reference guide for secure secret handling in the SoundHash project. For detailed information, see the [Security and Secrets Management](README.md#security-and-secrets-management) section in the README.

## Protected Files (Never Commit These)

| File | Purpose | How to Get It |
|------|---------|---------------|
| `.env` | All environment variables and secrets | Copy from `.env.example` and fill in |
| `credentials.json` | Google OAuth 2.0 client credentials | Follow [YOUTUBE_OAUTH_SETUP.md](YOUTUBE_OAUTH_SETUP.md) for step-by-step instructions in Google Cloud Console. |
| `token.json` | OAuth refresh tokens | Generated by `setup_youtube_api.py` |
| `cookies.txt` | Browser cookies for yt-dlp | Export from browser using extensions |

**Status:** ✅ All files above are in `.gitignore`

## Quick Setup Checklist

- [ ] Clone repository
- [ ] Copy `.env.example` to `.env`
- [ ] Fill in database credentials in `.env`
- [ ] Download `credentials.json` for YouTube OAuth (see [YOUTUBE_OAUTH_SETUP.md](YOUTUBE_OAUTH_SETUP.md))
- [ ] Run `python scripts/setup_youtube_api.py` to generate `token.json`
- [ ] Add Twitter/Reddit credentials to `.env` if needed (see [AUTH_SETUP.md](AUTH_SETUP.md))
- [ ] Verify files are ignored: `git status --ignored`

## Before You Commit

Always run these checks before committing:

```bash
# 1. Check for secrets in staged files
gitleaks detect --no-git --verbose

# 2. Verify sensitive files are ignored
git status --ignored | grep -E "(\.env|credentials|token|cookies)"

# 3. Review what you're about to commit
git diff --cached
```

## GitHub Actions Secrets

For CI/CD workflows, add these to **Settings → Secrets and variables → Actions**:

- `DATABASE_URL` - PostgreSQL connection string
- `YOUTUBE_API_KEY` - YouTube Data API key (if using API key method)
- `TWITTER_CONSUMER_KEY` - Twitter API consumer key
- `TWITTER_CONSUMER_SECRET` - Twitter API consumer secret
- `TWITTER_ACCESS_TOKEN` - Twitter access token
- `TWITTER_ACCESS_TOKEN_SECRET` - Twitter access token secret
- `REDDIT_CLIENT_ID` - Reddit app client ID
- `REDDIT_CLIENT_SECRET` - Reddit app client secret

## Security Scanning

This repository has automatic security scanning configured:

- **Tool:** [Gitleaks](https://github.com/gitleaks/gitleaks)
- **Triggers:** Every push, PR, and weekly on Monday
- **Action:** CI fails if secrets are detected
- **Config:** See `.gitleaks.toml` for custom rules

## If You Accidentally Commit a Secret

**⚠️ DO THIS IMMEDIATELY:**

1. **Revoke the secret** at the service provider (Google, Twitter, Reddit, etc.)
2. **Remove from git history:**
   ```bash
   # For recent commits (not pushed yet)
   git reset --soft HEAD~1
   git restore --staged <file-with-secret>
   
   # For pushed commits (requires force push - coordinate with team)
   # Use BFG Repo-Cleaner or git-filter-branch
   ```
3. **Generate a new secret** and update `.env`
4. **Add to `.gitignore`** if not already there
5. **Notify team** if applicable

## Common Mistakes to Avoid

❌ Committing `.env` instead of `.env.example`
❌ Hardcoding API keys in Python files
❌ Storing tokens in comments for "temporary" use
❌ Sharing credentials via chat or email
❌ Using production credentials in development
❌ Forgetting to add new secret files to `.gitignore`

## Resources

- [Main Security Documentation](README.md#security-and-secrets-management)
- [YouTube OAuth Setup](YOUTUBE_OAUTH_SETUP.md)
- [Twitter & Reddit Auth Setup](AUTH_SETUP.md)
- [Gitleaks Documentation](https://github.com/gitleaks/gitleaks)
- [GitHub Secrets Guide](https://docs.github.com/en/actions/security-guides/encrypted-secrets)

## Questions?

If you're unsure about how to handle a particular credential or secret:

1. Check if it's already documented in the guides above
2. Assume it should NOT be committed
3. Add it to `.env` and `.gitignore`
4. Ask in the team chat or create an issue

**When in doubt, don't commit it!**
